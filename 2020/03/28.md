# [TIL] 2020-03-28

🔑 : 스프링 부트

## 📔 처음 배우는 스프링 부트 2
### 📍 1장: 스프링 부트 입문하기
* 웹 개발을 하려면 `Tomcat`, `Jetty`, `Undertow` 같은 서블릿 컨테이너를 설치하고, 프로젝트 내에 필요한 환경을 구성해야 함
* 스프링은 안정성, 성능, DI(의존성 주입) 등 강력한 장점을 가지고 있지만, 개발 환경 설정의 어려움이 있어 이러한 어려움을 개선하기 위해 "스프링 부트"를 만듦
* **스프링 부트** : 필요한 환경 설정을 최소화하고, 개발자가 비즈니스 로직에 집중할 수 있도록 도와주어 생산성을 크게 향상함

#### ✅ 스프링 부트 특징
* 임베디드 톰캣, 제티, 언더토우를 사용해서 독립 실행이 가능한 스프링 애플리케이션 개발
* 통합 스타터를 제공하여 메이븐/그레이들 구성 간소화
* 스타터를 통한 자동화된 스프링 설정 제공
* 번거로운 XML 설정을 요구하지 않음
* JAR을 이용해서 자바 옵션만으로도 배포가 가능
* 애플리케이션의 모니터링과 관리를 위한 스프링 액츄에이터(Spring Actuator) 제공

스프링 부트는 스프링 프레임워크라는 큰 틀에 속하는 도구일 뿐, 완전 새로운 것이 아님

> ‘Just Run’에 가까워지도록 많은 설정을 간소화하기 위해 노력한 도구  

#### ✅ 스프링 부트 프로젝트 설계
* **세션 레디스, H2** : 세션을 관리하는 NoSQL(레디스)과 기본 데이터 저장을 위한 RDB(H2, MySQL)
* **스프링 부트 웹 MVC** : 기본적인 커뮤니티 페이지
* **스프링 부트 세션 레디스** : 레디스를 사용한 세션 관리
* **스프링 부트 시큐리티 / 스프링 부트 OAuth2** : 커뮤니티의 회원 인증 및 권한 처리
* **스프링 부트 데이터 레스트** : REST API 만들기
* **스프링 부트 배치** : 주기적으로 백엔드 작업 처리. (EX: 페이스북 API를 사용하여 게시판의 공유 개수를 DB에 저장)

#### ✅ 스프링 부트 스타터 살펴보기
* 스프링 부트에서는 스타터를 이용해 의존관계를 일일이 설정하지 않고 간편하게 설정할 수 있음
* 스프링 부트 스타터가 빌드에 필요한 의존성을 자동으로 관리하기 때문
* 필요한 dependency를 `pom.xml`(메이븐)이나, `build.gradle`(그레이들)에 추가하면 됨
* 스프링 부트 버전에 따른 차이점은 **https://github.com/spring-projects/spring-boom**에서 Wiki의 ‘Release Notes' 를 참고하자

#### ✅ 책에서 사용할 스타터
* `spring-boot-starter` : 스프링 부트의 코어, auto-configuration, logging, yaml 제공
* `spring-boot-starter-aop` : 관점 지향 프로그래밍을 위한 스타터
* `spring-boot-starter-batch` : 스프링 배치를 사용하는데 필요한 스타터
* `spring-boot-starter-data-jpa` : 스프링 데이터 JPA와 하이버네이트를 사용하는 데 필요한 스타터
* `spring-boot-starter-data-redis` : 레디스와 제디스(자바에서 쉽게 레디스를 사용하게끔 도와줌) 설정 자동화 스타터
* `spring-boot-starter-data-rest` : 스프링 데이터 저장소 방식에 맞춘 REST API를 제공하는 스타터
* `spring-boot-starter-thymeleaf` : 타임리프 템플릿 엔진을 사용하는 데 필요한 스타터
* `spring-boot-starter-jdbc` : 톰켓 JDBC 커넥션 풀에 사용하는 스타터
* `spring-boot-starter-security` : 각종 보안에 사용하는 스프링 시큐리티 스타터
* `spring-boot-starter-oauth2` : OAuth2 인증에 사용하는 스타터
* `spring-boot-starter-validation` : 자바 빈 검증에 사용하는 스타터
* `spring-boot-starter-web` : 웹을 만드는 데 사용하는 스타터(스프링 MVC, REST형, 임베디드 톰캣, 기타 라이브러리 포함)

#### ✅ 스프링 부트 장단점
* 의존성 버전을 올릴 때, 충분한 호환성 테스트를 거치므로 수동 설정에 비해 안정된 버전이 제공된다는 최소한의 보장을 얻을 수 있음
* 라이브러리 버그에 대해서 스프링 팀의 버그픽스 버전을 받기 편리함
* 간단한 어노테이션 설정, 프로퍼티 설정으로 원하는 기능을 빠르게 적용할 수 있음 (설정 간소화)
* 별도의 외장 톰캣이 필요 없고, 톰캣 버전도 쉽게 관리 가능
* 설정을 개인화 하면 스프링 부트 없이 사용하는 것과 같은 어려움이 있음
* 특정 설정을 개인화 하거나 설정 자체를 바꾸려면 내부 코드를 들여다봐야 함

### 📍 2장: 스프링 부트 환경 설정
* 그레이들은 메이븐과 마찬가지로 **규칙 기반으로 빌드를 구성**(무슨 말이지?) 할 수 있음
* 그레이들은 Task(테스크)를 사용하면 빌드 순서도 제어할 수 있음
* (이 프로젝트에서는) 그레이들로 빌드하고, 멀티 프로젝트를 구성해서 공통으로 사용되는 코드를 재활용 할 것

> 오라클에서 JDK를 설치하는 과정에서 "리얼월드 HTTP”에서 읽었던 싱글 사인 온을 볼 수 있었다.  

* `@RestController` : `@Controller`와 `@ResponseBody`를 합쳐놓은 역할을 수행. 어노테이션을 사용하면 스프링은 반환값이 Response Body 부분에 자동으로 바인딩 됨. 스프링에서 RESTful 웹 서비스를 만들 때 주로 사용함
* `@GetMapping` : Get 방식으로 경로를 받는 매핑 어노테이션. value 값을 별도로 지정하지 않으면 기본 값인 빈 값(“”)이 들어감

#### ✅ 그레이들 설치 및 빌드하기
* 메이븐 설정 파일(`pom.xml`)은 XML 기반으로 작성되어 있어 동적인 행위에 제약이 있음
* 그레이들은 Ant로부터 기본적인 빌드 도구의 특징을, 메이븐으로부터 의존 라이브러리 관리 기능을 차용함
* 그레이들을 사용하여 멀티 프로젝트 구성 시, 메이븐의 상속 구조 대신 설정 주입 방식을 사용하므로 훨씬 유연하게 빌드 환경을 구성할 수 있음
* 그레이들을 따로 설치하지 않아도, 스프링 이니셜라이저로 프로젝트를 생성하면 해당 프로젝트에 그레이들이 자동으로 설치됨
	* **자동 설치하는 이유** : 프로젝트를 처음 설정할 때, 그레이들 관련 빌드 설정(Gradle Wrapper)을 자동으로 해주기 때문
	* 그레이들 래퍼를 설치해 VCS(git 등)에서 관리하면 공동 작업자들이 그레이들 설치 및 버전 관리를 편리하게 할 수 있음
* `gradle-wrapper.properties`에서 `distributionUrl`을 원하는 그레이들 버전으로 수정 가능

#### ✅ 그레이들 멀티 프로젝트 구성하기
* **멀티 프로젝트** : 공통 코드를 하나의 프로젝트로 분리하고 재사용 할 때 유용함
* 하나의 서비스에 웹, API, 배치 등 여러 프로젝트가 존재할 때, 공통된 도메인에 컬럼 추가/변경을 하는 경우 각 프로젝트를 일일이 변경하지 않고 공통 부분 수정으로 한 번에 모두 변경할 수 있음
* 아무리 작게 구성해도 일정 수준 이상의 트래픽을 감당하려면, 사용자와의 접점을 담당하는 서버(이하 Web 프로젝트), DB와의 접점을 담당하는 서버(이하 API 프로젝트)로 구분하여 구성하게 됨
* `settings.gradle` : 그레이들 설정 파일, 특정 명령 규칙에 따라 그레이들에서 자동 인식하고 설정

멀티 프로젝트를 구성하면 코드 재사용성이 높아지고, 한 서비스에 관련된 여러 프로젝트를 마치 하나의 통합 프로젝트처럼 관리할 수 있음

> **Ref** : [blog-code/gradle-multi-modules at master · jojoldu/blog-code · GitHub](https://github.com/jojoldu/blog-code/tree/master/gradle-multi-modules)  

* 빌드는 항상 root 프로젝트를 기준으로 진행할 예정이기에 root 외에 나머지 프로젝트에는 `gradle` 폴더, `gradlew` 등의 파일이 없으며 `build.gradle`과 `src` 폴더만 존재
* 책에는 root의 `build.gradle`에 대한 정보가 없어서 오류를 겪었는데 위 링크의 글을 보고 설정해주었더니 정상적으로 동작했음. 초보자에겐 설명이 조금 부실한 것 같다 😂


#### ✅ 환경 프로퍼티 파일 설정하기
* 스프링 부트 프로퍼티 파일은 설정과 정적 값을 ‘키-값’ 형태로 관리
* `application-{profile}.yml` : 원하는 프로파일 값으로 YAML 파일을 추가하면 애플리케이션 실행 시 지정한 프로파일 값을 바탕으로 실행함

```
// 프로파일 값을 적용해서 애플리케이션을 실행하는 방법
$ java -jar … -D spring.profiles.active=dev
```
* 스프링 부트 프로젝트는 JAR 파일로 빌드해서 서버에서 직접 간단한 명령으로 실행할 수 있음
* 터미널에서는 위와 같이 실행해 프로파일 값을 활성화 할 수 있음
* 프로파일 별로 디렉토리를 생성하고 그 안에 설정 파일을 위치시키는 방법도 있다.

> **Ref** : [Spring Boot Gradle Profile (dev/prod) 세팅](https://blog.naver.com/writer0713/221538134545)  

#### ✅ YAML 파일 매핑하기
* YAML 파일은 깊이에 따라 관계를 구분짓기 때문에, List, Set, Map 등 다양한 바인딩형 매핑이 훨씬 간편함
* `@Value`, `@ConfigurationProperties` 어노테이션을 주로 사용
