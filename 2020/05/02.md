# [TIL] 2020-05-02

## 📔 자바스크립트 패턴과 테스트: 2장
### 📍 2.2 의존성 주입 프레임워크
* 객체가 의존하는 코드로 인해 테스트를 하기 어렵다.
* 의존성을 주입하는 방식으로 바꾸면 단위 테스트를 만드는 문제를 해결할 수 있다.
* `ConferenceWebSvc`와 `Messenger`와의 의존성을 하드 코딩하지 말고, 이들을 `Attendee`에 주입하는 것
* 실제 운영 환경에서는 진짜 의존성을 주입하지만, 단위 테스트용의 경우 모의체(fake)나 재스민 스파이같은 대체제를 주입하면 된다.

```js
// 운영 환경:
var attendee = new Attendee(new ConferenceWebSvc(), new Messenger(), id);

// 개발(테스트) 환경:
var attendee = new Attendee(fakeService, fakeMessenger, id);
```

* 빈자의 의존성(poor man’s dependency injection) : DI 프레임워크를 사용하지 않고 의존성을 주입하는 것
* 생성자 단계에서 사용할 객체를 파라미터로 받으면 됨

#### ✅ 의존성을 주입하여 믿음직한 코드 만들기
> 정리 : 이전 챕터에서는 의존성을 주입해서 다른 방법으로 할 수 없는 단위 테스트를 수행하도록 했음  

* DI는 실제 객체보다 주입한 스파이나 모의 객체에 더 많은 제어권을 안겨주므로, 다양한 에러 조건과 기이한 상황을 만들어내기 쉬움
* 혹시 모를 만약의 사태를 폭넓게 커버할 수 있게 테스트를 작성하는데 도움을 줌
* DI는 (하드 코딩을 막아주기 때문에) 코드 재사용을 적극적으로 유도함

#### ✅ 의존성 주입의 모든 것
아래 질문 중 한 가지라도 답변이 “예” 일 경우, 직접 인스턴스화(`new`로 만드는 것) 하지 말고 주입하는 방향으로 생각을 전환하는 것이 좋음

* 객체 또는 의존성 중 어느 하나라도 DB, 설정 파일, HTTP, 기타 인프라 등의 외부 자원에 의존하는가?
* 객체 내부에서 발생할지 모를 에러를 테스트에서 고려해야 하나?
* 특정한 방향으로 객체를 작동시켜야 할 테스트가 있는가?
* 이 서드파티(third-party) 제공 객체가 아니라 온전히 내가 소유한 객체인가?

#### ✅ 의존성 주입 프레임워크의 동작 과정
1. 애플리케이션이 시작되자 마자 각 인젝터블(injectable, _주입 가능한 모든 의존성을 집합적으로 일컫는 말_) 명을 확인하고, 해당 인젝터블이 지닌 의존성을 지칭하며 순서대로 DI 컨테이너에 등록
2. 객체가 필요하면 컨테이너에 요청
3. 컨테이너는 일단 요청받은 객체와 그 의존성을 모두 재귀적으로 인스턴스화
4. 요건에 따라 필요한 객체에 의존성을 주입
