# [TIL] 2020-04-01

## 📔 처음 배우는 스프링 부트: 4장, 스프링 부트 웹
### 📍 도메인 매핑하기
JPA를 사용해 DB와 도메인 클래스를 연결시켜주는 작업 (도메인 클래스를 생성해서 H2 DB에 매핑)
* 레파지토리(Repository) : 스프링이 관리하는 컴포넌트에서 퍼시스턴스 계층에 대해 더 명확하게 명시하는 특수한 제네릭 스테레오타입
* 퍼시스턴스(Persistence) 계층 : 물리적 저장공간. 영속성을 가진 파일이나 DB에 로직을 구현하는 것을 뜻하기도 함

#### ✅ 사용한 어노테이션 설명
* `@GeneratedValue(strategy = …)` : 기본 키가 자동으로 할당되도록 설정하는 어노테이션. 할당 전략을 선택할 수 있는데, `IDENTITY`는 키 생성을 데이터베이스에 위임
	* 스프링 부트 1.x에서는 기본 전략이 `IDENTITY` 였으나, 스프링 부트 2.x 부터는 기본 전략이 `TABLE`로 변경되었음
* `@Enumerated(EnumType.String)` : Enum 타입 매핑용 어노테이션. 자바 enum 형과 데이터베이스 데이터 변환을 지원. 자바 enum 형을 데이터베이스 String 형으로 변환해서 저장하겠다는 뜻
* `@OneToOne(fetch = FetchType.LAZY)` : 도메인과 도메인이 필드 값으로 가지고 있는 다른 도메인을 1:1 관계로 설정하는 어노테이션
	* DB에 저장할 때 해당 도메인 전체가 저장되는 것이 아니라, KEY 값이 저장됨
	* `eager` : 처음 Board 도메인을 조회할 때, 즉시 관련 User 객체를 함께 조회한다.
	* `lazy` : 객체를 조회하는 시점이 아닌, 실제 사용될 때 조회한다.
* `LocalDateTime` : 자바 8에 새로 추가된 기능으로, 날짜 관련된 기능을 제공
	* 이전에는 `JodaDateTime`을 사용했는데, 자바 8부터는 의존성을 포함할 필요 없이 `LocalDateTime`을 사용할 수 있음

### 📍 도메인 테스트하기
스프링 부트에서 지원하는 `@DataJpaTest`를 사용해서 도메인을 테스트
* `@DataJpaTest` : JPA에 대한 테스트를 지원하는 어노테이션. 테스트 시 실행된 변경 사항이 실제 DB에 반영되지 않음 (테스트 수행 후 이전 데이터로 롤백)

#### ✅ `JpaMappingTest` 클래스 생성
* `@RunWith` : JUnit에 내장된 러너를 사용하는 대신, 어노테이션에 정의된 클래스를 호출함. JUnit의 확장 기능을 지정하여 각 테스트 시 독립적인 애플리케이션 컨텍스트를 보장
* `@DataJpaTest` : 스프링 부트에서 JPA 테스트를 위한 전용 어노테이션. 
* `@Before` : 테스트 전에 실행되어야 할 메서드를 선언
* `@Test` : 실제 테스트가 진행 될 메서드를 선언

#### ✅ `Repository` 인터페이스 생성
> 빌더 패턴 : [자바 빌더 패턴 Spring @Builder :: 우종선](https://fors.tistory.com/451)  

* **빌더 패턴** : 객체의 생성 과정과 표현 방법을 분리해서 객체를 단계별 동일한 생성 절차로 복잡한 객체로 만드는 패턴
* Lombok Getter가 cannot resolve 오류가 발생할 때 : [IntelliJ - How to solve lombok “Cannot resolve symbol ‘log’”](https://junho85.pe.kr/831)

#### ✅ `Service` 클래스 생성
* **서비스** : 스프링이 관리하는 컴포넌트에서 서비스 계층에 대해 더 명확하게 명시하는 특수한 제네릭 스테레오 형식
* `@Service` : 서비스로 사용될 컴포넌트 정의
* `find*`로 해당하는 값을 `Repository`에서 꺼내 객체를 반환

#### ✅ `Controller` 클래스 생성
* `@Autowired` : 의존성 주입
* `@GetMapping` : 매핑 경로를 중괄호를 사용해서 여러 개 받을 수 있음
* `@RequestParam` : 필수 파라미터를 지정, 바인딩할 값이 없을 때 기본 값을 설정할 수 있음
* `@PageableDefault` : size, sort, direction 등을 사용해 페이징 처리에 대한 규약을 정의

### 📍 DB에 데이터 넣기
* `CommandLineRunner` : 애플리케이션 구동 후 특정 코드를 실행시키고 싶을 때 직접 구현하는 인터페이스
	* 애플리케이션 구동 시 테스트 데이터를 함께 생성하여 데모 프로젝트를 실행/테스트 하고 싶을 때 편리
	* 여러 `CommandLineRunner`를 구현해서 같은 애플리케이션 컨텍스트의 빈에 사용 가능

#### ✅ `CommandLineRunner` 인터페이스 추가
* **DI** : 스프링의 주요 특성 중 하나로, 의존 관계 주입이라고 함. 
* 스프링은 빈으로 생성된 메서드에 파라미터로 DI하는 메커니즘이 존재
* `CommandLineRunner`는 예제 외에도 다양한 방법으로 구현할 수 있지만, 어떤 방법으로 사용하더라도 빈으로 등록해야 함

### 📍 뷰 구성하기
뷰를 구성하기 위해 다양한 서버 사이드 템플릿 엔진(타임리프, 프리마커, 무스타치 등)을 사용할 수 있음
* **서버 사이드 템플릿** : 미리 정의된 HTML에 데이터를 반영해 뷰를 만드는 작업을 서버에서 진행하고 클라이언트에 전달하는 방식
	* 흔히 사용하는 JSP, 타임리프 등이 서버 사이드 템플릿 엔진
	* 스프링 부트 2.0에서 지원하는 템플릿 엔진은 타임리프, 프리마커, 무스타치, 그루비 템플릿 등이 있음

#### ✅ 게시글 리스트 기능 만들기
* `th` : 기존의 HTML을 효과적으로 대체하는 네임스페이스. `th:test` 프로퍼티와 함께 사용하면 내부에 표현된 `#{…}` 구문을 실제 값으로 대체
* `@{…}` : 타임리프의 기본 링크 표현 구문. server-relative URL 방식
	* server-relative URL 방식 : 동일 서버 내의 다른 컨텍스트로 연결해주는 방식으로, 서버의 루트 경로를 기준으로 구문에서 경로를 탐색해 href의 URL을 대체
* `th:each` : 반복 구문으로, `${boardList}`에 담긴 리스트를 Board 객체로 순차 처리
* 날짜 포맷팅 : 포맷팅 없이 날짜를 출력하면 `LocalDateTime`의 기본형인 ISO 방식으로 출력됨
	* `temporals`를 사용할 수 있는 `thymeleaf-extras-java8time` 의존성은 `spring-boot-starter-thymeleaf` 스타터에 포함되어 있음
	* `format()`, `arrayFormat()`, `listFormat()`, `setFormat()` 등이 있음

#### ✅ 페이징 처리하기
* `th:with` : 태그 안에서 사용할 변수를 정의
* `pageable` : 해당 페이지가 처음인지(`isFirst`), 마지막인지(`isLast`)에 대한 데이터를 Boolean 형식으로 제공, 이를 이용해서 이전/다음 페이지의 미노출 여부를 결정
* `th:each` : `startNumber`에서 `endNumber`까지를 출력
	* `pageable`은 number가 0부터 시작하므로, 1을 더해서 표시

#### ✅ 폼 생성하기
* `${…?}` : 구문 뒤에 `?`를 붙여서 null 체크를 추가해 값이 null인 경우에 빈 값을 출력
